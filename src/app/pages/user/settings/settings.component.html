<div class="innerBodyUser">
	<div class="innerBodyContent">
		<div class="pageSettings">
			<div class="content">
				<div class="back" (click)="goBack()">
					<button mat-icon-button>
						<i label="back"></i>
					</button>
					<div class="text">{{translations?.common?.back}}</div>
				</div>

				<div class="pageTitle">{{translations?.settings?.title}}</div>

				<mat-tab-group mat-stretch-tabs>
		 			<mat-tab label="{{translations?.settings?.editProfile}}">
		 				<div class="avatarBackground">
							<div class="avatar">
								<div class="image" [matMenuTriggerFor]="imageOptions">
									<img [src]="sessionData.current.avatar ? sessionData.current.avatarUrl : env.avatar"/>

									<div class="upload">
										<i class="icon200 white" label="camera"></i>
									</div>
								</div>
								<input type="file" hidden (change)="openImage('upload', $event)" accept=".jpg,.jpeg,.png,.gif,.bmp,.tiff" #avatarFile>

								<mat-menu #imageOptions="matMenu" [overlapTrigger]="false">
									<button mat-menu-item (click)="avatarFile.click()">{{translations?.settings?.uploadPhoto}}</button>
									<button mat-menu-item (click)="openImage('remove', $event)">{{translations?.settings?.removePhoto}}</button>
									<mat-divider></mat-divider>
									<button mat-menu-item>{{translations?.common?.cancel}}</button>
								</mat-menu>
							</div>
						</div>

						<div class="form">
							<form [formGroup]="actionFormPersonalData" (ngSubmit)="submitPersonal()">
								<div class="theme">
									<mat-radio-group formControlName="theme" name="theme">
										<mat-radio-button [value]="0" class="white">{{translations?.settings?.themes?.white}}</mat-radio-button>
										<mat-radio-button [value]="1" class="black">{{translations?.settings?.themes?.black}}</mat-radio-button>
									</mat-radio-group>
								</div>

								<mat-form-field>
									<input matInput placeholder="{{translations?.settings?.username}}" #Username maxlength="100" formControlName="username">
									<div class="validators">
										<i class="icon75 blue" label="check" *ngIf="validatorUsername == 'done'"></i>
										<i class="icon75 red" label="close" *ngIf="validatorUsername == 'bad'"></i>
										<mat-progress-spinner mode="indeterminate" *ngIf="validatorUsername == 'load'"></mat-progress-spinner>
									</div>
									<mat-hint align="end">{{Username.value.length}}/100</mat-hint>
								</mat-form-field>

								<mat-form-field>
									<input matInput placeholder="{{translations?.settings?.name}}" #Name maxlength="100" formControlName="name">
									<mat-hint align="end">{{Name.value.length}}/100</mat-hint>
								</mat-form-field>

								<mat-form-field>
									<mat-select placeholder="{{translations?.settings?.language}}" formControlName="language">
										<mat-option *ngFor="let x of sessionData.current.languages" [value]="x.id">{{x.caption}}</mat-option>
									</mat-select>
								</mat-form-field>

								<div class="richAbout">
									<div class="label">{{translations?.settings?.about}}</div>
									<div class="inner">
										<div class="highlights" [innerHTML]="sessionData.current.about"></div>
										<div class="origin" contenteditable="plaintext-only" [innerHTML]="sessionData.current.aboutOriginal" (input)="aboutEdit('writingChanges', $event.target.innerText)"></div>
									</div>
								</div>

								<mat-checkbox formControlName="private">{{translations?.common?.privateAccount}}</mat-checkbox>

								<div class="buttons">
									<button mat-raised-button type="submit" [disabled]="submitPersonalLoading">
										<mat-progress-spinner mode="indeterminate" *ngIf="submitPersonalLoading"></mat-progress-spinner>
										{{translations?.common?.submit}}
									</button>
								</div>
							</form>
						</div>
		 			</mat-tab>

		 			<mat-tab label="{{translations?.settings?.changePassword}}">
						<div class="form">
							<form [formGroup]="actionFormPasswordData" (ngSubmit)="submitPassword()">
								<mat-form-field>
									<input matInput type="{{showPassword ? 'text' : 'password'}}" placeholder="{{translations?.settings?.oldPassword}}" #OldPassword maxlength="100" formControlName="oldPassword" name="current-password" autocomplete="on">
									<button mat-button matSuffix mat-icon-button type="button" (click)="showPassword=!showPassword" tabindex="-1">
										<i class="icon65 grey" [ngClass]="{'active': showPassword}" label="visibility"></i>
									</button>
									<div class="validators withButton">
										<i class="icon75 red" label="close" *ngIf="validatorOldPassword == 'bad'"></i>
									</div>
									<mat-hint align="end">{{OldPassword.value.length}}/100</mat-hint>
								</mat-form-field>

								<mat-form-field>
									<input matInput type="{{showPassword ? 'text' : 'password'}}" placeholder="{{translations?.settings?.newPassword}}" #NewPassword maxlength="100" formControlName="newPassword" name="new-password" autocomplete="on">
									<button mat-button matSuffix mat-icon-button type="button" (click)="showPassword=!showPassword" tabindex="-1">
										<i class="icon65 grey" [ngClass]="{'active': showPassword}" label="visibility"></i>
									</button>
									<div class="validators withButton">
										<i class="icon75 blue" label="check" *ngIf="validatorNewPassword == 'done'"></i>
										<i class="icon75 red" label="close" *ngIf="validatorNewPassword == 'bad'"></i>
										<mat-progress-spinner mode="indeterminate" *ngIf="validatorNewPassword == 'load'"></mat-progress-spinner>
									</div>
									<mat-hint align="end">{{NewPassword.value.length}}/100</mat-hint>
								</mat-form-field>

								<mat-form-field>
									<input matInput type="{{showPassword ? 'text' : 'password'}}" placeholder="{{translations?.settings?.confirmNewPassword}}" #ConfirmPassword maxlength="100" formControlName="confirmPassword" name="confirm-password" autocomplete="on">
									<button mat-button matSuffix mat-icon-button type="button" (click)="showPassword=!showPassword" tabindex="-1">
										<i class="icon65 grey" [ngClass]="{'active': showPassword}" label="visibility"></i>
									</button>
									<div class="validators withButton">
										<i class="icon75 blue" label="check" *ngIf="validatorNewPassword == 'done'"></i>
										<i class="icon75 red" label="close" *ngIf="validatorNewPassword == 'bad'"></i>
										<mat-progress-spinner mode="indeterminate" *ngIf="validatorNewPassword == 'load'"></mat-progress-spinner>
									</div>
									<mat-hint align="end">{{ConfirmPassword.value.length}}/100</mat-hint>
								</mat-form-field>

								<div class="buttons">
									<button mat-raised-button type="submit" [disabled]="submitPasswordLoading">
										<mat-progress-spinner mode="indeterminate" *ngIf="submitPasswordLoading"></mat-progress-spinner>
										{{translations?.common?.submit}}
									</button>
								</div>
							</form>
						</div>
		 			</mat-tab>

		 			<mat-tab label="{{translations?.settings?.accounts}}">
		 				<ul class="sessions">
							<li *ngFor="let x of sessionData?.sessions" [ngClass]="{active: sessionData?.current?.id == x.id}">
								<div mat-ripple class="inner">
									<div class="avatar" (click)="setCurrentUser(x)">
										<img [src]="x.avatar ? x.avatarUrl : env.avatar"/>
									</div>

									<div class="text" (click)="setCurrentUser(x)">
										<div class="in">
											<div class="data">
												<a class="name">{{x.username}}</a>
												<i class="icon50 blue" label="official" *ngIf="x.official" matTooltip="{{translations?.common?.verifiedAccount}}"></i>
											</div>
											<div class="info">@{{x.username}}</div>
										</div>
									</div>

									<div class="actions">
										<button mat-button [matMenuTriggerFor]="signOut">{{translations?.common?.logOut}}</button>
										<mat-menu #signOut="matMenu" yPosition="below" xPosition="before" class="removeBox">
											<div class="text">
												{{x.name}}
												<br>
												{{translations?.common?.leaveSite}}
											</div>
											<div class="buttons">
												<button mat-menu-item>{{translations?.common?.no}}</button>
												<button mat-menu-item (click)="closeSession(x)">{{translations?.common?.yes}}</button>
											</div>
										</mat-menu>
									</div>
								</div>
							</li>

							<li *ngIf="sessionData.sessions.length < 10" (click)="openNewSession()">
								<div mat-ripple class="inner">
									<div class="add">
										<i label="add"></i>
									</div>
									<div class="text">
										<div class="in">
											<div class="data">{{translations?.common?.addAccount}}</div>
											<div class="info">{{translations?.common?.setAnotherAccount}}</div>
										</div>
									</div>
								</div>
							</li>
					    </ul>
		 			</mat-tab>
		 		</mat-tab-group>
			</div>
		</div>
	</div>
</div>
